[supervisord]
nodaemon=true
user=frappe
logfile=/home/frappe/frappe-bench/logs/supervisord.log
pidfile=/home/frappe/frappe-bench/logs/supervisord.pid

[program:backend]
command=bash -c "sleep 5 && /home/frappe/frappe-bench/env/bin/gunicorn -b 127.0.0.1:${BACKEND_PORT:-8000} -w ${GUNICORN_WORKERS:-2} --max-requests ${GUNICORN_MAX_REQUESTS:-1200} --max-requests-jitter ${GUNICORN_MAX_REQUESTS_JITTER:-50} -t ${HTTP_TIMEOUT:-120} --graceful-timeout 30 frappe.app:application --preload"
directory=/home/frappe/frappe-bench
user=frappe
autostart=true
autorestart=true
stdout_logfile=/home/frappe/frappe-bench/logs/backend.log
stderr_logfile=/home/frappe/frappe-bench/logs/backend.error.log
priority=200
startsecs=10
stopwaitsecs=40
killasgroup=true

[program:frontend]
command=nginx-entrypoint.sh
directory=/home/frappe/frappe-bench
user=frappe
autostart=true
autorestart=true
stdout_logfile=/home/frappe/frappe-bench/logs/frontend.log
stderr_logfile=/home/frappe/frappe-bench/logs/frontend.error.log
priority=300

[program:websocket]
command=bash -c "sleep 5 && node /home/frappe/frappe-bench/apps/frappe/socketio.js"
directory=/home/frappe/frappe-bench
user=frappe
autostart=true
autorestart=true
stdout_logfile=/home/frappe/frappe-bench/logs/websocket.log
stderr_logfile=/home/frappe/frappe-bench/logs/websocket.error.log
priority=250
startsecs=10
stopwaitsecs=40
killasgroup=true

[program:scheduler]
command=bench schedule
directory=/home/frappe/frappe-bench
user=frappe
autostart=true
autorestart=true
stdout_logfile=/home/frappe/frappe-bench/logs/scheduler.log
stderr_logfile=/home/frappe/frappe-bench/logs/scheduler.error.log
priority=400
startsecs=10
stopwaitsecs=40
killasgroup=true

[program:queue-short]
command=bench worker --quiet --queue short,default
directory=/home/frappe/frappe-bench
user=frappe
autostart=true
autorestart=true
stdout_logfile=/home/frappe/frappe-bench/logs/queue-short.log
stderr_logfile=/home/frappe/frappe-bench/logs/queue-short.error.log
priority=500
startsecs=10
stopwaitsecs=360
killasgroup=true

[program:queue-long]
command=bench worker --quiet --queue long,default,short
directory=/home/frappe/frappe-bench
user=frappe
autostart=true
autorestart=true
stdout_logfile=/home/frappe/frappe-bench/logs/queue-long.log
stderr_logfile=/home/frappe/frappe-bench/logs/queue-long.error.log
priority=600
startsecs=10
stopwaitsecs=360
killasgroup=true

[unix_http_server]
file=/tmp/supervisor.sock

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

