# railway.toml

# See https://docs.railway.com/reference/config-as-code
# for all available options.

[build]
# Instruct Railway to build the service using the Dockerfile in the root.
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
# Specify the internal port the application listens on. This is crucial for health checks and routing.
port = 8000

# This command runs the entrypoint script before the application starts.
# The script parses connection strings into environment variables for Frappe.
preDeployCommand = "sh scripts/railway-entrypoint.sh"

# The start command is inherited from the Docker image's entrypoint, so it's not needed here.

# Restart the service if it fails, up to 10 times.
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Use Frappe's built-in ping endpoint for health checks.
# This ensures the application is responsive before the deployment is considered successful.
healthcheckPath = "/api/method/frappe.utils.ping"
healthcheckTimeout = 300
healthcheckInterval = 60
